#!/bin/bash

## Description: Run all quality checks (lint, phpstan, tests)
## Usage: quality
## Example: "ddev quality"

echo "=== Running all quality checks ==="
echo ""

echo "1/3: Checking code style..."
.Build/bin/php-cs-fixer fix --config=.php-cs-fixer.dist.php --dry-run --diff
LINT_EXIT=$?

echo ""
echo "2/3: Running PHPStan..."
.Build/bin/phpstan analyse -c Build/phpstan/phpstan.neon
PHPSTAN_EXIT=$?

echo ""
echo "3/3: Running tests..."
.Build/bin/phpunit -c phpunit.xml
TEST_EXIT=$?

echo ""
echo "=== Quality Check Summary ==="
echo "Lint:    $([ $LINT_EXIT -eq 0 ] && echo 'PASS' || echo 'FAIL')"
echo "PHPStan: $([ $PHPSTAN_EXIT -eq 0 ] && echo 'PASS' || echo 'FAIL')"
echo "Tests:   $([ $TEST_EXIT -eq 0 ] && echo 'PASS' || echo 'FAIL')"

# Exit with failure if any check failed
if [ $LINT_EXIT -ne 0 ] || [ $PHPSTAN_EXIT -ne 0 ] || [ $TEST_EXIT -ne 0 ]; then
    exit 1
fi
